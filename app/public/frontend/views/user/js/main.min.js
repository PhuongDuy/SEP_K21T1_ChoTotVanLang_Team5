var Request=function(e,t){var n={method:["GET","POST","PUT","PATCH","DELETE","HEAD","CUSTOM"],responseType:["arraybuffer","blob","document","json","text"],contentType:["application/json","application/xml","application/atom+xml","application/x-www-form-urlencoded","application/base64","application/octet-stream","application/javascript","multipart/form-data","multipart/alternative","multipart/mixed","text/plain","text/css","text/html"]};return"object"!=typeof t&&(t={}),"boolean"!=typeof t.async&&(t.async=!0),"string"==typeof t.method&&n.method.join(":").match(new RegExp(t.method,"i"))?t.method=t.method.toUpperCase():t.method="GET","string"==typeof t.responseType&&n.responseType.join(":").match(new RegExp(t.responseType,"i"))?t.responseType=t.responseType.toLowerCase():t.responseType="","string"==typeof t.contentType&&n.contentType.join(":").match(new RegExp(t.contentType,"i"))?t.contentType=t.contentType.toLowerCase():t.contentType="application/x-www-form-urlencoded","undefined"==typeof t.payload&&(t.payload=null),"object"!=typeof t.headers&&(t.headers={}),new Promise(function(n,i){var a=new URL(e||window.location.href,window.location.origin),o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState===o.DONE)try{/^2/.test(o.status)?n.call(o,o.response):i.call(o,o.statusText)}catch(e){i.call(o,e)}},o.open(t.method,a.href,t.async),t.async&&(o.responseType=t.responseType),"POST"===t.method&&t.payload instanceof FormData!=!0&&o.setRequestHeader("Content-Type",t.contentType),t.payload instanceof FormData&&"function"==typeof t.payload._blob&&(t.payload=t.payload._blob());for(var s in t.headers)o.setRequestHeader(s,t.headers[s]);o.send(t.payload)})},ValidateForm=function(e,t){if("undefined"==typeof e||e instanceof HTMLFormElement!=!0||"object"!=typeof t)return!1;for(var n=0,i=t.length,a=t[0];n<i;n++,a=t[n]){if("undefined"==typeof e[a.index])return!1;"boolean"==typeof a.required&&a.required!==!1&&(e[a.index].value.length<1||"array"==typeof a.length||"undefined"!=typeof a.regex&&a.regex instanceof RegExp!=!1)}return!0},ItemList=function(e,t){null!==e&&e instanceof HTMLElement==!0&&(this.init(e),this.initEvent(),"undefined"!=typeof t&&null!==t&&this.assignData(t),document.body.appendChild(this.popup))};ItemList.prototype.init=function(e){this.container=e,this.popup=document.createElement("div"),this.popup.className="item-list",this.popup.innerHTML='<div class="container"><div class="popup"><div class="title clearfix"><div class="text">Vui lòng chọn</div><a class="close" title="Đóng"><i class="fa fa-close"></i></a></div><ul class="clearfix"></ul></div></div>'},ItemList.prototype.initEvent=function(){var e={open:function(e){this.popup.className=this.popup.className.split("visible").join(" ").trim()+" visible"},close:function(e){this.popup.className=this.popup.className.split("visible").join(" ").trim()},select:function(e){if(e.preventDefault(),["A","I"].indexOf(e.target.tagName)!==-1)return"I"===e.target.tagName&&"fa fa-check-circle-o"==e.target.className?void this.chooseItem(e.target.parentNode.parentNode.parentNode.querySelector("a")):"A"===e.target.tagName&&"check"==e.target.className?void this.chooseItem(e.target.parentNode.parentNode.querySelector("a")):void this.renderItems(e.target)}};this.container.addEventListener("click",e.open.bind(this)),this.popup.querySelector("a.close").addEventListener("click",e.close.bind(this)),this.popup.querySelector("ul.clearfix").addEventListener("click",e.select.bind(this))},ItemList.prototype.chooseItem=function(e){if(e instanceof HTMLElement==!0){[].slice.call(this.popup.getElementsByTagName("li")).forEach(function(e,t){e.className=e.className.split("active").join(" ").trim()});var t=e.parentNode.parentNode;t.className=t.className.split("active").join(" ").trim()+" active",this.container.dataset.id=e.dataset.id,this.container.dataset.name=e.dataset.name,this.popup.className=this.popup.className.split("visible").join(" ").trim();var n=this.container.querySelector("span");return n&&(n.innerText=e.dataset.name||this.chooses&&this.chooses.name||""),this.container.dispatchEvent(new CustomEvent("itemlist:chooses",{detail:e.dataset})),this.container.classList.contains("location")&&new URL(location).pathname.indexOf(new URL(e.href).pathname)==-1&&(window.location.href=e.href),this.result=e.dataset}},ItemList.prototype.renderItems=function(e){if("undefined"!=typeof e&&e instanceof HTMLElement==!0&&"undefined"!=typeof this.data){var t='<li><div><a class="DATA:STATE" href="DATA:URI" data-name="DATA:NAME" data-id="DATA:ID">DATA:NAME</a></div><div class="clearfix"><a class="check"><i class="fa fa-check-circle-o"></i></a></div></li>',n=new String,i=new String,a=e.dataset.id||0,o=this.container.dataset.rootId||0,s=this.container.dataset.rootUri||"",r=this.container.dataset.rootName||this.container.textContent.trim(),c=this,d=function(e){return c.container.classList.contains("location")!==!0?"#":location.origin.concat("/",e+"/")};a.toString().split(",").forEach(function(a){var c=null,l=a.replace(/[^-][\D]+/g,"");if("undefined"==typeof this.data[l]||0===this.data[l].length||e.className.indexOf("opened")!==-1){if(!0!=this.popup.querySelector("ul > li")instanceof HTMLElement){var p=Object.values(this.data).find(function(e){return e.id==l||e.find(function(e){return e.id==l})});if(p){i="undefined"!=typeof e.dataset.state&&e.dataset.state.indexOf("opened")!==-1?t.replace(/DATA:STATE/g,e.dataset.state):t.replace(/DATA:STATE/g,"opened");var u=Object.values(this.data).find(function(e){return e.id==p[0].sub||e.find(function(e){return e.id==p[0].sub})});"undefined"==typeof u&&(u=p.find(function(e){return e.id==l})),"undefined"==typeof u.id&&(u=u.find(function(e){return e.id==p[0].sub})),o!==l&&u.sub!==o?(n=n.concat('<li><a class="back" data-id="'+u.sub+'"> ...</a></li>'),n=n.concat(i.replace(/DATA:NAME/g,u.name).replace(/DATA:URI/g,d(u.rewrite)).replace(/DATA:ID/g,u.id))):n=n.concat(i.replace(/DATA:NAME/g,r).replace(/DATA:URI/g,d(s)).replace(/DATA:ID/g,o)),this.chooses=p.find(function(e){return e.id==l});for(var h=0,f=p.length;h<f;h++)n=n.concat(t.replace(/DATA:STATE/g,"select").replace(/DATA:NAME/g,p[h].name).replace(/DATA:URI/g,d(p[h].rewrite)).replace(/DATA:ID/g,p[h].id));n.length>0&&(this.popup.querySelector("ul.clearfix").innerHTML=n)}return}return this.chooseItem(e)}for(var m in this.data)if(c=this.data[m].find(function(e){return e.id==l}))break;c?(i="undefined"!=typeof e.dataset.state&&e.dataset.state.indexOf("opened")!==-1?t.replace(/DATA:STATE/g,e.dataset.state):t.replace(/DATA:STATE/g,"opened"),o!==l&&(n=n.concat('<li><a class="back" data-id="'+c.sub+'"> ...</a></li>')),n=n.concat(i.replace(/DATA:NAME/g,c.name).replace(/DATA:URI/g,d(c.rewrite)).replace(/DATA:ID/g,c.id)),this.chooses=c):n=n.concat(t.replace(/DATA:STATE/g,"opened").replace(/DATA:NAME/g,r).replace(/DATA:URI/g,d(s)).replace(/DATA:ID/g,o));for(var h=0,f=this.data[l].length;h<f;h++)n=n.concat(t.replace(/DATA:STATE/g,"select").replace(/DATA:NAME/g,this.data[l][h].name).replace(/DATA:URI/g,d(this.data[l][h].rewrite)).replace(/DATA:ID/g,this.data[l][h].id))}.bind(this)),n.length>0&&(this.popup.querySelector("ul.clearfix").innerHTML=n)}},ItemList.prototype.assignData=function(e){"undefined"!=typeof e&&null!==e&&(this.data=e,this.result=this.container.dataset,this.renderItems(this.container),"undefined"!=typeof this.chooses&&this.chooses.id!=this.result.rootId&&this.chooseItem(this.popup.querySelector('a[data-id="'+this.result.id+'"]')))};var ImageBrowser=function(e){return("undefined"==typeof e||e instanceof HTMLElement==!0)&&(this.container=e,this.items=[],this.data=new Array,this.popup=new Popup({header:"Thông Báo",content:null,hidden:!0,buttons:[{text:"Xác nhận",id:"confirm",callback:function(e){this.popup.hidden=!0}},{text:"Đóng lại",id:"close",callback:function(e){this.popup.hidden=!0}}]}),this.container.querySelectorAll("div.item[data-id]").forEach(this.eachItem.bind(this)),void this.container.addEventListener("click",this.eventCallback.bind(this)))};ImageBrowser.prototype.eventCallback=function(e){return!(e.target.className.indexOf("item")===-1||!e.target.dataset.id||!this.items[e.target.dataset.id])&&this[this.data[e.target.dataset.id]?"removeItem":"openBrowse"](e.target.dataset.id)},ImageBrowser.prototype.openBrowse=function(){return"undefined"==typeof this.browse&&(this.browse=document.createElement("input"),this.browse.setAttribute("type","file"),this.browse.setAttribute("accept","image/*"),this.browse.setAttribute("multiple","multiple"),this.browse.addEventListener("change",this.renderItem.bind(this))),this.browse.click()},ImageBrowser.prototype.renderItem=function(e){for(var t=e.target,n=window.URL||window.webkitURL,i=0,a=t.files.length;i<a;i++){for(var o=0;o<this.data.length;o++)if("undefined"==typeof this.data[o]||null===this.data[o]){this.items[o].style.backgroundImage='url("'+n.createObjectURL(t.files.item(i))+'")',this.items[o].classList.add("trash"),this.data[o]=t.files.item(i);break}if(i>this.data.length)break}},ImageBrowser.prototype.eachItem=function(e,t){var n=e.dataset.id||t;e.classList.contains("trash")||""!==e.style.backgroundImage?this.data[n]=new Blob([],{type:"image/jpeg"}):this.data[n]=null,this.items[n]=e},ImageBrowser.prototype.removeItem=function(e){if("undefined"!=typeof this.data[e]&&null!==this.data[e]){var t=function(t){this.items[e].style.backgroundImage="none",this.items[e].classList.remove("trash"),this.data[e]=null,"undefined"!=typeof this.browse&&(this.browse.type="",this.browse.type="file")},n=function(e){this.removeEventListener("button:close",arguments.callee),this.removeEventListener("button:confirm",i)},i=t.bind(this);this.popup.addEventListener("button:confirm",i),this.popup.addEventListener("button:close",n),this.popup.content.innerHTML="Bạn có chắc chắn muốn xóa hình ảnh này khỏi danh sách?",this.popup.hidden=!1}};var Popup=function(e){if("object"!=typeof e)throw new Error("Invalid value for argument 'options'. Expected 'Object'");if(this.options=e,this.buttons=[],this.popup=document.createElement("div"),this.popup.innerHTML='<div class="md-modal md-effect md-show"><div class="md-content"><h3></h3><div class="container"></div><div class="buttons"></div></div></div><div class="md-overlay"></div>',e.hasOwnProperty("header")!==!1?this.popup.querySelector("h3").innerHTML=e.header:this.popup.querySelector("h3").parentNode.removeChild(this.popup.querySelector("h3")),e.hasOwnProperty("content")!==!1?this.popup.querySelector(".container").innerHTML=e.content:this.popup.querySelector(".container").parentNode.removeChild(this.popup.querySelector(".container")),e.hasOwnProperty("hidden")!==!1&&"boolean"==typeof e.hidden&&(this.popup.hidden=e.hidden),e.hasOwnProperty("buttons")!==!1){if("object"!=typeof e.buttons)return;for(var t=0,n=e.buttons.length;t<n;t++){try{var i=document.createElement("button"),a="button:"+e.buttons[t].id,o=function(e,t){"function"==typeof this.options.buttons[e].callback&&this.options.buttons[e].callback.call(this,t),this.popup.dispatchEvent(this.buttons[t.target.id.slice(7)])};this.buttons[e.buttons[t].id]=new Event(a),i.id=a,i.innerText=e.buttons[t].text,i.addEventListener("click",o.bind(this,t))}catch(e){}this.popup.querySelector(".buttons").appendChild(i)}}else this.popup.querySelector(".buttons").parentNode.removeChild(this.popup.querySelector(".buttons"));return this.popup.header=this.popup.querySelector("h3"),this.popup.content=this.popup.querySelector(".container"),document.body.appendChild(this.popup),this.popup},TabList=function(e){if("undefined"==typeof e||e instanceof HTMLElement!=!0)return!1;var t=e.querySelectorAll(".tab"),n=[].slice.call(t).map(function(e,t){return e.dataset.tab}),i=function(e,t){n.indexOf(e.dataset.tabId)!==-1&&e.classList.add("hidden")},a=function(e){document.querySelectorAll("[data-tab-id]").forEach(i);var t=document.querySelector(".title.active");t&&t.classList.remove("active");var n=document.querySelector('[data-tab-id="'+e.target.dataset.tab+'"]');n&&n.classList.remove("hidden"),e.target.parentNode.parentNode.classList.add("active")};t.forEach(function(e,t){e.addEventListener("click",a)})},Pagination=function(e,t){if("undefined"==typeof e||e instanceof HTMLElement!=!0)return!1;t=Number(parseInt(t));var n=document.createElement("div"),i=e.querySelectorAll(".product");return n.className="paging clearfix",n.innerHTML='<div class="container clearfix"></div>',n.container=n.querySelector(".container"),n.container.addEventListener("click",function(n){if("A"===n.target.tagName){n.target.parentNode.querySelectorAll("a").forEach(function(e){e.classList.remove("active")}),n.target.classList.add("active");var a=Number(parseInt(n.target.textContent));i.forEach(function(e,n){n+1<=a*t&&n+1>a*t-t?e.classList.remove("hidden"):e.classList.add("hidden")}),document.body.scrollTop=e.offsetTop+e.offsetHeight/3}}),n.reload=function(){n.container.innerHTML="",i=e.querySelectorAll(".product");for(var a,o=1,s=Math.ceil(i.length/t);o<=s;o++)a=document.createElement("a"),a.className=1===o?"active":"",a.innerHTML="<span>"+o+"</span>",n.container.appendChild(a)},n.reload(),e.appendChild(n),n},PaymentRequest=function(e){var t=new Popup({header:"Thông Báo",content:null,hidden:!0,buttons:[{text:"Đóng lại",id:"close",callback:function(e){this.popup.remove()}}]}),n=e.target.querySelector("fieldset"),i=e.target.querySelector('button[type="submit"]');if(this instanceof HTMLFormElement!=!1){var a=new FormData(this);i.innerHTML='<i class="fa fa-spin fa-spinner"></i>'+i.textContent,n.disabled=!0,Request(null,{method:"POST",payload:a,responseType:"JSON"}).then(function(e){t.content.innerHTML=e.message,t.hidden=!1,n.disabled=!1,i.innerHTML=i.textContent})}return!1},ContactRequest=function(e){var t=new Popup({header:"Thông Báo",content:null,hidden:!0,buttons:[{text:"Đóng lại",id:"close",callback:function(e){this.popup.remove()}}]}),n=e.target.querySelector("fieldset"),i=e.target.querySelector('button[type="submit"]');if(this instanceof HTMLFormElement!=!1){var a=new FormData(this);i.innerHTML='<i class="fa fa-spin fa-spinner"></i>'+i.textContent,n.disabled=!0,Request(null,{method:"POST",payload:a,responseType:"JSON"}).then(function(e){t.content.innerHTML=e.message,t.hidden=!1,n.disabled=!1,i.innerHTML=i.textContent})}return!1},CommentRequest=function(e){var t=new Popup({header:"Thông Báo",content:null,hidden:!0,buttons:[{text:"Đóng lại",id:"close",callback:function(e){this.popup.remove()}}]}),n=e.target.querySelector("fieldset"),i=e.target.querySelector('button[type="submit"]');if(this instanceof HTMLFormElement!=!1){var a=this,o=new FormData(this);if("undefined"!=typeof grecaptcha&&0===o.get("g-recaptcha-response").length)return t.content.innerHTML="Vui lòng xác nhận bạn không phải là người máy để có thể bình luận trong tin đăng này.",t.hidden=!1,!1;i.innerHTML='<i class="fa fa-spin fa-spinner"></i>'+i.textContent,n.disabled=!0;var s=function(e){var t=document.createElement("div"),n="";t.className="comment fresh",n+='<div class="avatar"><img src="'+e.user.avatar+'" alt="'+e.user.name+'"></div>',n+='<div class="content">',n+='\t<div class="info">',n+='\t\t<a href="'+e.user.url+'">'+e.user.name+"</a>",n+="\t\t<span>"+e.comment.beautified_date+"</span>",n+="\t</div>",n+='\t<div class="description">',n+="\t\t"+e.comment.content,n+='\t\t<div class="action">',n+='\t\t\t<a title="Thích tin rao này" data-id="'+e.comment.id+'" class="like">',n+='\t\t\t\t<i class="fa fa-thumbs-up"></i><span>0</span>',n+="\t\t\t</a>",n+='\t\t\t<a title="Trả lời bình luận" data-id="'+e.comment.id+'" class="reply">',n+='\t\t\t\t<i class="fa fa-comment"></i><span>Trả lời</span>',n+="\t\t\t</a>",n+="\t\t</div>",n+="\t</div>",n+="</div>",t.innerHTML=n,t.setAttribute("data-id",e.comment.id),a.content.value=null,"object"==typeof grecaptcha&&grecaptcha.reset();var i=Number(o.get("reply"));0!==i?(t.querySelector("a.reply").setAttribute("data-id",i),parentCommentElement=document.querySelector('.list_comment .comment[data-id="'+i+'"] .content')):parentCommentElement=document.querySelector(".list_comment"),parentCommentElement.insertBefore(t,parentCommentElement.querySelector(".comment")),t.style.visibility="visible",t.tabIndex="-1",t.focus()};Request(this.action,{method:"POST",payload:o,responseType:"JSON"}).then(function(e){e&&e.status!==!0&&e.message?(t.content.innerHTML=e.message,t.hidden=!1):s(e),n.disabled=!1,i.innerHTML=i.textContent})}return!1},ProfileRequest=function(e){var t=new Popup({header:"Thông Báo",content:null,hidden:!0,buttons:[{text:"Đóng lại",id:"close",callback:function(e){this.popup.remove()}}]}),n=e.target.querySelector("fieldset"),i=e.target.querySelector('button[type="submit"]');if(this instanceof HTMLFormElement!=!1){var a=new FormData(this);i.innerHTML='<i class="fa fa-spin fa-spinner"></i>'+i.textContent,n.disabled=!0,Request(null,{method:"POST",payload:a,responseType:"JSON"}).then(function(e){t.content.innerHTML=e.message,t.hidden=!1,n.disabled=!1,i.innerHTML=i.textContent})}return!1},ThreadRequest=function(e){var t=new Popup({header:"Thông Báo",content:null,hidden:!0,buttons:[{text:"Đóng lại",id:"close",callback:function(e){this.popup.hidden=!0}}]}),n=e.target.querySelector("fieldset"),i=e.target.querySelector('button[type="submit"]');if(this instanceof HTMLFormElement!=!1){var a=new FormData(this);if("on"!==a.get("agree"))return t.content.innerHTML="Bạn chưa chấp nhận điều khoản sử dụng của website Chú Gióng nên không thể tiến hành đăng tin",t.hidden=!1,!1;if("object"!=typeof itemListLocationId||["0"].indexOf(itemListLocationId.result.id)!==-1)return t.content.innerHTML="Khu vực đã chọn không phù hợp. Vui lòng thực hiện lại thao tác",t.hidden=!1,!1;if("object"!=typeof itemListCategoryId||["0"].indexOf(itemListCategoryId.result.id)!==-1)return t.content.innerHTML="Danh mục đã chọn không phù hợp. Vui lòng thực hiện lại thao tác",t.hidden=!1,!1;if("object"!=typeof itemListPrefixId||["-1"].indexOf(itemListPrefixId.result.id)!==-1)return t.content.innerHTML="Loại tin đã chọn không phù hợp. Vui lòng thực hiện lại thao tác",t.hidden=!1,!1;if("string"!=typeof a.get("contact[0][name]")||"string"!=typeof a.get("contact[0][phone]"))return t.content.innerHTML="Có lỗi xảy ra, thông tin liên hệ không hoàn thiện. Vui lòng tải lại trang và thử lại",t.hidden=!1,!1;if(0===a.get("contact[0][name]").length||0===a.get("contact[0][phone]").length)return t.content.innerHTML="Bạn chưa nhập đầy đủ thông tin liên hệ cho tin đăng này. Vui lòng thực hiện lại thao tác",t.hidden=!1,!1;try{imageBrowser.data.forEach(function(e,t){null===e&&(e=new Blob([],{type:"delete",name:"blob"})),e instanceof File==!1&&!1==e instanceof Blob||a.append("image["+t+"]",e,e.name||"blob")}),a.append("location_id",itemListLocationId.result.id),a.append("category_id",itemListCategoryId.result.id),a.append("type",itemListPrefixId.result.id),a.has("price")&&a.set("price",a.get("price").replace(/[^\d]/g,""))}catch(e){return t.content.innerHTML="Phát hiện lỗi không xác định trong quá trình xử lý. Vui lòng tải lại trang và thử lại",t.hidden=!1,!1}i.innerHTML='<i class="fa fa-spin fa-spinner"></i>'+i.textContent,n.disabled=!0,Request(null,{method:"POST",payload:a,responseType:"JSON"}).then(function(e){return e.hasOwnProperty("redirect")&&""!==e.redirect?window.location.href=e.redirect:(t.content.innerHTML=e.message,t.hidden=!1,n.disabled=!1,void(i.innerHTML=i.textContent))})}return!1},Reaction=function(e,t){return"undefined"!=typeof e&&e instanceof HTMLElement==!0&&("string"==typeof t&&0!==t.length&&void e.addEventListener("click",function(e){var n=e.path.find(function(e){return"A"==e.nodeName&&e.classList.contains("like")&&e.dataset.id});n instanceof HTMLElement==!0&&(n.classList.toggle("active"),Request(t+n.dataset.id,{responseType:"JSON"}).then(function(e){if(e.status!==!0){new Popup({header:"Thông Báo",content:e.message,buttons:[{text:"Đóng lại",id:"close",callback:function(e){document.body.removeChild(this.popup)}}]});return void n.classList.toggle("active")}var t=n.querySelector("span");t&&(t.innerText=e.number_of_like)}))}))};Reaction.Request={POST:"ajax/reaction/post/",TOPIC:"ajax/reaction/topic/",COMMENT:"ajax/reaction/comment/"};