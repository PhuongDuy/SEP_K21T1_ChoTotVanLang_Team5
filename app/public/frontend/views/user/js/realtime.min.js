"use strict";var Realtime=Realtime||{options:{customToken:"",uid:"",displayName:"Anonymous",ttl:5e3,ip:"127.0.0.1",country:"XX",message:!1,tracking:!1,notification:!1},instanceId:Math.random().toString(36).replace(/[^a-z0-9]+/g,"").substr(0,18).toUpperCase()};Realtime.init=function(){if(!window.firebase||!firebase.app instanceof Function)throw"You have not configured and imported the Firebase SDK. Make sure you go through the codelab setup instructions.";return this.auth=firebase.auth(),this.storage=firebase.storage(),this.database=firebase.database(),this.ref={sessions:this.database.ref("sessions"),connected:this.database.ref(".info/connected")},this.ref.sessions.off(),this.ref.connected.off(),this.ref.connected.on("value",this.event.onConnStateChanged.bind(this)),localStorage.setItem("instanceId",this.instanceId),this},Realtime.entry=function(e){if("object"!=typeof e)throw"";return["customToken","uid","displayName","ttl","ip","country","tracking","message","notification"].forEach(function(t,n){e.hasOwnProperty(t)&&(this.options[t]=e[t])}.bind(this)),this},Realtime.event={onAuthStateChanged:function(e){return null===e||"undefined"!=typeof this.toggleSignIn||!e.hasOwnProperty("uid")||e.uid.toString()===this.options.uid.toString()&&0!==this.options.uid&&""!==this.options.uid&&0!==this.options.customToken.length?null!==e&&!e.isAnonymous||0===this.options.customToken.length?null===e&&"undefined"==typeof this.toggleSignIn?void this.auth.signInAnonymously():"undefined"!=typeof this.toggleSignIn&&"signout"===this.toggleSignIn.toLowerCase()?void delete this.toggleSignIn:void(e.isAnonymous===!1&&(this.options.message===!0&&this.message.register.call(this),this.options.notification===!0&&this.notification.register.call(this))):void this.signInWithCustomToken(this.options.customToken):void this.signOut()},onConnStateChanged:function(e){e.val()===!0&&this.auth.onAuthStateChanged(this.event.onAuthStateChanged.bind(this))},onMessageRecevied:function(e){this.interface.updateMessage(e)},onNotificationRecevied:function(e){this.interface.updateNotification(e)}},Realtime.message={register:function(){"undefined"!=typeof this.auth.currentUser&&this.auth.currentUser.isAnonymous!==!0&&(this.ref.messages=this.database.ref("messages/"+this.auth.currentUser.uid),this.ref.messages.off(),this.ref.messages.on("value",this.event.onMessageRecevied.bind(this)))}},Realtime.notification={register:function(){"undefined"!=typeof this.auth.currentUser&&this.auth.currentUser.isAnonymous!==!0&&(this.ref.notifications=this.database.ref("notifications/"+this.auth.currentUser.uid),this.ref.notifications.off(),this.ref.notifications.orderByChild("seen").equalTo(!1).on("value",this.event.onNotificationRecevied.bind(this)))}},Realtime.tracking={pushSession:function(){this.ref.sessions.push({ip:this.options.ip,uid:this.auth.currentUser.uid,href:window.location.href,country:this.options.country,referrer:document.referrer,userAgent:window.navigator.userAgent,endedAt:firebase.database.ServerValue.TIMESTAMP,startedAt:firebase.database.ServerValue.TIMESTAMP,displayName:this.auth.currentUser.displayName||"Anonymous"}).then(function(e){console.log("Authentication:",this.auth.currentUser.uid,e.key),"undefined"==typeof this.x0000001&&(this.x0000001=setInterval(this.tracking.updateTimestamp.bind(this),this.options.ttl)),this.session=e}.bind(this)).catch(function(e){console.log(e)})},updateTimestamp:function(){localStorage.instanceId!==this.instanceId&&"undefined"!=typeof this.x0000001&&clearInterval(this.x0000001),this.session.update({endedAt:firebase.database.ServerValue.TIMESTAMP}).then(function(){console.log("Update TIMESTAMP",new Date)})},ipAddress:function(){}},Realtime.interface={updateNotification:function(e){Number(document.getElementById("notification_number").innerHTML)>0&&0===e.numChildren()||(document.getElementById("notification_number").innerHTML=e.numChildren(),document.getElementById("notification_number").style.display=e.numChildren()>0?"block":"none",this.updateBadge())},updateMessage:function(e){Number(document.getElementById("message_number").innerHTML)>0&&0===e.numChildren()||(document.getElementById("message_number").innerHTML=e.numChildren(),document.getElementById("message_number").style.display=e.numChildren()>0?"block":"none",this.updateBadge())},updateBadge:function(){var e=Number(document.getElementById("message_number").innerHTML)+Number(document.getElementById("notification_number").innerHTML);document.getElementById("badge_number").style.display=e>0?"block":"none",document.getElementById("badge_number").innerHTML=e},isAnonymous:function(e){}},Realtime.signInWithCustomToken=function(e,t,n){this.toggleSignIn="signin",this.auth.signInWithCustomToken(e).then(t||new Function).catch(n||new Function)},Realtime.signInWithFacebook=function(e,t){this.facebookProvider=new firebase.auth.FacebookAuthProvider,this.facebookProvider.addScope("email"),this.facebookProvider.addScope("user_friends"),this.toggleSignIn="signin",this.auth.signInWithPopup(this.facebookProvider).then(e||new Function).catch(t||new Function)},Realtime.signInWithGoogle=function(e,t){this.googleProvider=new firebase.auth.GoogleAuthProvider,this.googleProvider.addScope("profile"),this.googleProvider.addScope("email"),this.toggleSignIn="signin",this.auth.signInWithPopup(this.googleProvider).then(e||new Function).catch(t||new Function)},Realtime.signOut=function(){"undefined"!=typeof this.x0000001&&clearInterval(this.x0000001),this.toggleSignIn="signout",this.auth.signOut()};
